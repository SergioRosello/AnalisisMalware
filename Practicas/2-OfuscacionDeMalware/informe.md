# Ofuscación de malware


## Descripción de las herramientas necesarias para el análisis de malware

### PEstudio
### X64dbg
### Scylla

## Análisis estático de la prueba de malware descargada

La prueba de Malware descargada es una versión de BlackMoon detectada el 03-12-2019

Podemos ver en la siguiente captura de pantalla, pruebas de que el malware a analizar ha sido empaquetado por una herramienta bastante conocida llamada UPX

![HxD prueba de UPX](./Fotos/HxD-AnalisisEstatico.png)


Otro indicativo de que el binario ha sido comprimido es que la diferencia entre el tamaño virtual y el tamaño real es enorme, tanto, que el tamaño real de la parte comprimida es 0.

![PPEE Tamaño virtual vs raw](./Fotos/PPEE-VirtualSizeRawSize.png)

Vemos ademas, como en las cabeceras opcionales nos dice que el `Address of Entry Point` es en `UPX0`

![PPEE Address of Entry Point](./Fotos/PPEE-AddressOfEntryPoint.png)

Todas estas indicaciones nos hacen concluir que se ha comprimido con UPX la sección UPX0, que, una vez ejecutado el malware, se iniciara la rutina de descompresión y se cederá el control a este sección, contenedora del malware, ya descomprimido.

## Análisis dinámico del malware

Levantando la aplicación de Wireshark e INetSim para analizar el comportamiento del malware a nivel de red, vemos que hace una serie de peticiones al servidor DNS para averiguar las direcciones IP de lo que aparentemente, parece que sean los servidores C2.

![INetSim reporte filtrado](./Fotos/inetsim-filtered-DNSConnections.png)

Podemos ver que algunas de las direcciones que pide son:

* pxi.hognoob.se
* qia.hognoob.se
* uio.hognoob.se
* uio.herohero.info

Al estar usando el INetSim, estas direcciones no se resuelven y el virus no es capaz de contactar con sus servidores C2.


En esta sección, se pretende encontrar alguna de las características estudiadas en el temario del curso. 

* Cifrado Cesar
* Base64
* XOR
* identificación de cryptosignatures

## Análisis desde el punto de vista del empaquetado de ejecutables

En esta sección se pretende desempaquetar el malware seleccionado para posteriormente hacer un volcado de memoria virtual a disco y averiguar las cabeceras
De esta forma, podemos analizar el malware como se ha creado desde el inicio, sin los inconvenientes introducidos por los packers.

### Desempaquetado manual

### Desempaquetado automático 
